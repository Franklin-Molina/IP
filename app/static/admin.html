<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Panel de Administración</title>
<style>
body { font-family: Arial, sans-serif; margin: 2em; }
h1, h2 { color: #333; }
.hidden { display: none; }
input, button { padding: 0.5em; margin: 0.2em; }
table { border-collapse: collapse; margin-top: 1em; }
th, td { border: 1px solid #ccc; padding: 0.5em; }
</style>
</head>
<body>
<h1>Panel de Administración</h1>

<div id="dashboard">
  <h2>Mis URLs Acortadas</h2>
  <table id="urls-table">
    <thead>
      <tr><th>Código</th><th>Original</th><th>Visitas</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <h2>Detalles de Visitas</h2>
  <table id="visits-table">
    <thead>
      <tr>
        <th>IP</th>
        <th>Fecha y Hora</th>
        <th>User-Agent</th>
        <th>Referrer</th>
        <th>Info Red</th>
        <th>Cookies</th>
        <th>Extra Params</th>
        <th>Dispositivo</th>
        
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const loginBtn = document.getElementById('login-btn');
const dashboard = document.getElementById('dashboard');
const loginSection = document.getElementById('login-section');
const urlsTableBody = document.querySelector('#urls-table tbody');
const visitsTable = document.getElementById('visits-table');
const visitsTableBody = visitsTable.querySelector('tbody');

async function loadUrls() {
  urlsTableBody.innerHTML = '';
  const response = await fetch('/api/user/urls'); // endpoint futuro, simulado aquí
  let urls = [];
  try {
    urls = await response.json();
  } catch {
    // Simulación de datos
    urls = [
      { short_code: 'abc123', original_url: 'https://example.com', total_visits: 2 },
      { short_code: 'xyz789', original_url: 'https://test.com', total_visits: 1 }
    ];
  }
  urls.forEach(url => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><a href="/${url.short_code}" target="_blank">${url.short_code}</a></td>
      <td>${url.original_url}</td>
      <td><button onclick="loadStats('${url.short_code}')">${url.total_visits}</button></td>
    `;
    urlsTableBody.appendChild(tr);
  });
}

async function loadStats(shortCode) {
  visitsTableBody.innerHTML = '';
  const response = await fetch('/api/stats/' + shortCode);
  const data = await response.json();
  data.visits.forEach(visit => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${visit.ip_address}</td>
      <td>${visit.timestamp}</td>
      <td>${visit.user_agent || ""}</td>
      <td>${visit.referrer || ""}</td>
      <td><pre>${visit.network_info || ""}</pre></td>
      <td><pre>${visit.cookies || ""}</pre></td>
      <td><pre>${visit.extra_params || ""}</pre></td>
      <td>${visit.device_info || ""}</td>
    `;
    visitsTableBody.appendChild(tr);
  });
}

// Cargar URLs al cargar la página
loadUrls();
</script>
</body>
</html>
